# Administrator Linux. Professional

## –°–µ—Ä–≤–µ—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è, –ø—Ä–µ–¥—ä—è–≤–ª—è–µ–º—ã–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤
- –ø–µ—Ä–µ–¥–∞—á—É –∞–ª–µ—Ä—Ç–æ–≤ –≤ Telegram
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤ –Ω–∞ –¥–∞—à–±–æ—Ä–¥–∞—Ö

### –û–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞

–í –∫–∞—á–µ—Å—Ç–≤–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π Ubuntu 22.04. 

–°–µ—Ä–≤–µ—Ä —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é **vagrant –∏ ansible**.

–î–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–µ—Ç—Å—è —Å–≤—è–∑–∫–∞ **Prometheus - Node Exporter**

–ê–ª–µ—Ä—Ç—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç **alertmanager**

–î–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Loki**

–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Grafana**. –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Grafana –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–≤–∏–∂–∏–æ–Ω–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö Prometheus, Loki, Postgresql, –∏ –ø—Ä–µ–¥–Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞.

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞—é—Ç—Å—è –≤ docker —Å –ø–æ–º–æ—â—å—é docker compose, —á—Ç–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –æ–±—É—Å–ª–æ–≤–ª–µ–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é –Ω—É–∂–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ –†–§.

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å—Ä–µ–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ [Vagrantfile](https://github.com/anashoff/otus/blob/master/project/Vagrantfile) –≤ —Å–æ—Å—Ç–∞–≤–µ –≤—Å–µ–≥–æ —Å—Ç–µ–Ω–¥–∞ –∏–ª–∏ –æ–¥–µ–ª—å–Ω–æ.

–î–∞–ª–µ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ä–æ–ª–∏ ansible

#### –†–æ–ª—å 

 [monilog](https://github.com/anashoff/otus/blob/master/project/roles/monilog/tasks/main.yaml)

```yaml
---
##### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ç–∏–ª–∏—Ç
- include_tasks: ../../common/tasks/install_utils.yml
##### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏
- include_tasks: ../../common/tasks/setup_time.yml

#####  –£—Å—Ç–∞–Ω–æ–≤–∫–∞ docker
- name: –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π Docker
  apt:
    name: "{{ item }}"
    state: absent
    purge: yes
  loop:
    - docker.io
    - docker-doc
    - docker-compose
    - podman-docker
    - containerd
    - runc
  ignore_errors: yes
- name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç
  apt:
    name:
      - gnupg
    state: present
    update_cache: yes
- name: –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –¥–ª—è –∫–ª—é—á–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
  file:
    path: /etc/apt/keyrings
    state: directory
    mode: '0755'
- name: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª—é—á–∞  Docker GPG
  ansible.builtin.get_url:
    url: https://download.docker.com/linux/ubuntu/gpg
    dest: /etc/apt/keyrings/docker.asc
    mode: '0644'
- name: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Docker
  apt_repository:
    repo: >-
      deb [arch=amd64 signed-by=/etc/apt/keyrings/docker.asc]
      https://download.docker.com/linux/ubuntu
      {{ ansible_facts.lsb.codename }}
      stable
    state: present
    filename: docker
    update_cache: yes
- name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
  apt:
    name:
      - docker-ce
      - docker-ce-cli
      - containerd.io
      - docker-buildx-plugin
      - docker-compose-plugin
    state: latest
    update_cache: yes
- name: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ Docker  
  service:
    name: docker
    state: started
    enabled: yes

##### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Prometheus, Grafana...
- name: –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –¥–ª—è docker compose
  file:
    path: "{{ compose_dir }}"
    state: directory
    mode: 0755

- name: –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Prometheus
  template:
    src: prometheus.yml.j2
    dest: "{{ compose_dir }}/{{ prometheus_config }}"
    mode: 0644

- name: –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö  Prometheus
  template:
    src: datasource.yml.j2
    dest: "{{ compose_dir }}/datasource.yml"
    mode: 0644

- name: –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Alertmanager
  template:
    src: alertmanager.yml.j2
    dest: "{{ compose_dir }}/{{ alertmanager_config }}"
    mode: 0644

- name: –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞ Telegram
  template:
    src: telegram.tmpl.j2
    dest: "{{ compose_dir }}/{{ telegram_template }}"
    mode: 0644

- name: –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∞–≤–∏–ª –∞–ª–µ—Ä—Ç–æ–≤
  template:
    src: alert.rules.yml.j2
    dest: "{{ compose_dir }}/{{ alert_rules }}"
    mode: 0644

- name: –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Loki
  template:
    src: loki-config.yaml.j2
    dest: "{{ compose_dir }}/loki-config.yaml"
    mode: 0644

- name: –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–≤–∏–∂–µ–Ω–∏–Ω–≥–∞ –¥–∞—à–±–æ—Ä–¥–∞ Grafana
  template:
    src: dashboard.yml.j2
    dest: "{{ compose_dir }}/dashboard.yml"
    mode: 0644  

- name: –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞—à–±–æ—Ä–¥–∞ Grafana
  template:
    src: dashboard.json.j2
    dest: "{{ compose_dir }}/dashboard.json"
    mode: 0644  

##### –ó–∞–ø—É—Å–∫ docker compose
- name: –ü–µ—Ä–µ–¥–∞—á–∞ —Ñ–∞–π–ª–∞ Docker Compose
  template:
    src: docker-compose.yml.j2
    dest: "{{ compose_dir }}/docker-compose.yml"
    mode: 0644
  notify: Restart stack

- name: –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Docker Compose
  command: docker compose -f docker-compose.yml up -d
  args:
    chdir: "{{ compose_dir }}"
  register: compose_output
  changed_when:
    - "'Creating' in compose_output.stdout"
    - or "'Recreating' in compose_output.stdout"
```

–ó–∞–¥–∞—á–∏ —Å –¥–∏—Ä–µ–∫—Ç–∏–≤–∞–º–∏ include tasks –æ–ø–∏—Å–∞–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ [–û–±—â–∏–µ –∑–∞–¥–∞—á–∏](https://github.com/anashoff/otus/tree/master/project/roles/common#readme) 

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —è—Å–µ–Ω –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è.

#### –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Prometheus

[prometheus.yml.j2](https://github.com/anashoff/otus/blob/master/project/roles/monilog/templates/prometheus.yml.j2)

```yaml
global:
  scrape_interval: 10s
  evaluation_interval: 10s

alerting:
  alertmanagers:
  - static_configs:
    - targets:
      - alertmanager:9093

rule_files:
  - /etc/prometheus/alert.rules.yml

scrape_configs:
  - job_name: 'Prometheus Monitoring Server'
    scrape_interval: 5s
    static_configs:
      - targets: ['prometheus:9090']
  - job_name: 'Web'
    scrape_interval: 5s
    static_configs:
      - targets: ['192.168.1.50:9100']
  - job_name: 'Angie-1'
    scrape_interval: 5s
    static_configs:
      - targets: ['192.168.1.51:9100']
  - job_name: 'Angie-2'
    scrape_interval: 5s
    static_configs:
      - targets: ['192.168.1.52:9100']
  - job_name: 'Database-1'
    scrape_interval: 5s
    static_configs:
      - targets: ['192.168.1.53:9100']
  - job_name: 'Database-2'
    scrape_interval: 5s
    static_configs:
      - targets: ['192.168.1.54:9100']
```

#### –§–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤–∏–ª –∞–ª–µ—Ä—Ç–æ–≤

[alert.rules.yml.j2](https://github.com/anashoff/otus/blob/master/project/roles/monilog/templates/alert.rules.yml.j2)

```yaml
{% raw %}
groups:
- name: example
  rules:
  - alert: InstanceDown
    expr: up == 0
    for: 10s
    labels:
      severity: critical
    annotations:
      summary: "Instance {{ $labels.instance }} down"
      description: "{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 30 seconds."
{% endraw %}
```

#### –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ alertmanager

[alertmanager.yml.j2](https://github.com/anashoff/otus/blob/master/project/roles/monilog/templates/alertmanager.yml.j2)

```yaml
{% raw %}
route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 1m
  repeat_interval: 3h
  receiver: 'telegram-notifications'
templates:
  - '/etc/alertmanager/telegram.tmpl'
receivers:
- name: 'telegram-notifications'
  telegram_configs:
  - bot_token: "76104"
    chat_id: -1002390
    api_url: "https://api.telegram.org"
    message: '{{ template "telegram.default" . }}'
    parse_mode: HTML
    send_resolved: true
{% endraw %}
```

#### –§–∞–π–ª —à–∞–±–ª–æ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ telegram

[telegram.tmpl.j2](https://github.com/anashoff/otus/blob/master/project/roles/monilog/templates/telegram.tmpl.j2)

```jinja
{% raw %}
{{ define "telegram.default" }}
{{ if gt (len .Alerts) 0 }}
{{ range .Alerts }}
{{ if eq .Status "firing"}}
<b>üö® {{ .Status | title }} üö®</b>
{{ else }}
<b>‚úÖ {{ .Status | title }} ‚úÖ</b>
{{ end }}
<b>–¢–∏–ø –∞–ª–µ—Ä—Ç–∞:</b> {{ .Labels.alertname  }}
<b>–•–æ—Å—Ç:</b> {{ .Labels.instance  }}
<b>–ò–º—è:</b> {{ .Labels.job  }}
<b>–í—Ä–µ–º—è:</b> {{ .StartsAt.Format "02.01.2006 15:04:05" }}UTC
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
{{ end }}
{{ end }}
{{ end }}
{% endraw %}
```

#### –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Loki

[loki-config.yaml.j2](https://github.com/anashoff/otus/blob/master/project/roles/monilog/templates/loki-config.yaml.j2)

```yaml
auth_enabled: false

server:
  http_listen_port: 3100
  grpc_listen_port: 9096
  log_level: debug
  grpc_server_max_concurrent_streams: 1000

common:
  instance_addr: 0.0.0.0  # –í–∞–∂–Ω–æ –¥–ª—è Docker!
  path_prefix: /loki
  storage:
    filesystem:
      chunks_directory: /loki/chunks
      rules_directory: /loki/rules
  replication_factor: 1
  ring:
    kvstore:
      store: inmemory

limits_config:
  allow_structured_metadata: true
  volume_enabled: true

schema_config:
  configs:
    - from: 2020-10-24
      store: tsdb
      object_store: filesystem
      schema: v13
      index:
        prefix: index_
        period: 24h

storage_config:
  tsdb_shipper:
    active_index_directory: /loki/index
    cache_location: /loki/cache
```

#### –§–∞–π–ª –ø—Ä–æ–≤–∏–∂–∏–æ–Ω–∏–Ω–≥–∞ —à–∞–±–ª–æ–Ω–∞ –¥–∞—à–±–æ—Ä–¥–∞ –¥–ª—è grafana

[dashboard.json.j2](https://github.com/anashoff/otus/blob/master/project/roles/monilog/templates/dashboard.json.j2) 

–î–æ—Å—Ç—É–ø–µ–Ω –ø–æ —Å—Å—ã–ª–∫–µ

#### –§–∞–π–ª –ø—Ä–æ–≤–∏–∂–∏–æ–Ω–∏–Ω–≥–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞ –¥–ª—è grafana

[dashboard.yml.j2](https://github.com/anashoff/otus/blob/master/project/roles/monilog/templates/dashboard.yml.j2)

```yaml
apiVersion: 1

providers:
- name: 'default'
  orgId: 1
  folder: ''
  type: file
  disableDeletion: false
  editable: true
  options:
    path: /etc/grafana/provisioning/dashboards
```
#### –§–∞–π–ª –ø—Ä–æ–≤–∏–∂–∏–æ–Ω–∏–Ω–≥–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è grafana

[datasource.yml.j2](https://github.com/anashoff/otus/blob/master/project/roles/monilog/templates/datasource.yml.j2)

```yaml
apiVersion: 1
datasources:
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://192.168.1.56:9090
    isDefault: true  # –°–¥–µ–ª–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    uid: prometheusdatasource
    jsonData:
    version: 1

  - name: postgresql53
    type: postgres
    access: proxy
    url: 192.168.1.53:5432
    database: postgres
    user: lims
    secureJsonData:
      password: qq1qq2qq3
    uid: postgresql53datasources
    jsonData:
      sslmode: disable
      maxOpenConns: 100
      maxIdleConns: 100
      maxIdleConnsAuto: true
      connMaxLifetime: 14400
      postgresVersion: 1400
      timescaledb: false
    editable: true
  - name: postgresql54
    type: grafana-postgresql-datasource
    access: proxy
    url: 192.168.1.54:5432
    uid: postgresql54datasources
    database: postgres
    user: lims
    secureJsonData:
      password: qq1qq2qq3
    jsonData:
      sslmode: disable
      maxOpenConns: 100
      maxIdleConns: 100
      maxIdleConnsAuto: true
      connMaxLifetime: 14400
      postgresVersion: 1400
      timescaledb: false
    editable: true
  - name: Loki
    type: loki
    access: proxy
    url: http://192.168.1.56:3100
    uid: lokidatasource 
    jsonData:
      maxLines: 1000
      derivedFields:
        - datasourceUid: prometheusdatasource
          matcherRegex: (?:pod|container)=("?)([^"]*)\1
          name: Prometheus
          url: http://192.168.1.56:9090
```

### –§–∞–π–ª docker compose

[docker-compose.yml.j2](https://github.com/anashoff/otus/blob/master/project/roles/monilog/templates/docker-compose.yml.j2)

```yaml
version: '3.8'

services:
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./{{ prometheus_config }}:/etc/prometheus/prometheus.yml
      - ./alert.rules.yml:/etc/prometheus/alert.rules.yml
    networks:
      - monitoring
    restart: unless-stopped
    depends_on:
      - alertmanager

  alertmanager:
    image: prom/alertmanager:latest
    container_name: alertmanager
    ports:
      - "9093:9093"
    volumes:
      - ./alertmanager.yml:/etc/alertmanager/alertmanager.yml
      - ./telegram.tmpl:/etc/alertmanager/telegram.tmpl
    networks:
      - monitoring
    restart: unless-stopped

  node_exporter:
    image: prom/node-exporter:latest
    container_name: node_exporter
    ports:
      - "9100:9100"
    networks:
      - monitoring
    restart: unless-stopped

  loki:
    image: grafana/loki:latest
    container_name: loki
    ports:
      - "3100:3100"
    networks:
      - monitoring
    command: -config.file=/etc/loki/local-config.yaml
    volumes:
      - loki-data:/loki
      - ./loki-config.yaml:/etc/loki/local-config.yaml
    restart: unless-stopped

  grafana:
    image: grafana/grafana-enterprise:latest
    container_name: grafana
    ports:
      - "3000:3000"
    volumes:
      - grafana-storage:/var/lib/grafana
      - ./datasource.yml:/etc/grafana/provisioning/datasources/datasource.yml
      - ./dashboard.yml:/etc/grafana/provisioning/dashboards/dashboard.yml
      - ./dashboard.json:/etc/grafana/provisioning/dashboards/dashboard.json
      
    networks:
      - monitoring
    environment:
      - GF_FEATURE_TOGGLES_ENABLE=tempoSearch,lokiLive
    restart: unless-stopped

networks:
  monitoring:
    driver: bridge

volumes:
  grafana-storage:
  loki-data:
```
#### –•–µ–Ω–¥–ª–µ—Ä—ã

[main.yaml](https://github.com/anashoff/otus/blob/master/project/roles/monilog/handlers/main.yaml)

```yaml
- name: Restart stack
  command: docker compose -f docker-compose.yml restart
  args:
    chdir: "{{ compose_dir }}"
```
#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```yaml
compose_dir: /opt/monitoring
compose_file: docker-compose.yml
prometheus_config: prometheus.yml
alertmanager_config: alertmanager.yml
alert_rules: alert.rules.yml
telegram_template: telegram.tmpl
loki_version: "2.9.4"
promtail_version: "2.9.4"
grafana_repo_url: "https://apt.grafana.com"
```

### –†–∞–±–æ—Ç–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º

–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ [Vagrantfile](https://github.com/anashoff/otus/blob/master/project/Vagrantfile) –≤ —Å–æ—Å—Ç–∞–≤–µ –≤—Å–µ–≥–æ —Å—Ç–µ–Ω–¥–∞ –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ –∫–æ–º–∞–Ω–¥–µ

```vagrant up monilog```

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—å—Å—è –≤ —Å–æ—Å—Ç–∞–≤–µ –≤—Å–µ–≥–æ —Å—Ç–µ–Ω–¥–∞ –∏–ª–∏ –æ–¥–µ–ª—å–Ω–æ –ø–æ –∫–æ–º–∞–Ω–¥–µ

```ansible-pleybook playbook.yml --tag ml```

–û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ ~ 5 –º–∏–Ω—É—Ç.

–í—ã–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ 

```vagrant halt monilog```

–°—Ç–∏—Ä–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã

```vagrant destroy monilog```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –Ω–∞ –ø—Ä–∏–µ–º –∞–ª–µ—Ä—Ç–æ–≤

–î–ª—è –ø—Ä–∏–µ–º–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –∏–∑ Alertmanager –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞

–ù–∞—Ö–æ–¥–∏–º –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–µ –æ—Ç—Ü–∞ –≤—Å–µ—Ö –±–æ—Ç–æ–≤ @BotFather –∏ –ø–∏—à–µ–º –µ–º—É:

``` /start```

–í –æ—Ç–≤–µ—Ç –±–æ—Ç –≤—ã–¥–∞—Å—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º –±–æ—Ç–æ–º. –ù–∞—á–∏–Ω–∞–µ–º —Å —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞:

```/newbot```

BotFather –∑–∞–ø—Ä–æ—Å–∏—Ç –∏–º—è –¥–ª—è —ç—Ç–æ–≥–æ –±–æ—Ç–∞ –∏ –µ–≥–æ —é–∑–µ—Ä–Ω–µ–π–º –≤ —Ç–µ–ª–µ–≥—Ä–∞–º. 

–í–≤–µ–¥–µ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–º—è

```my_otus_alert```

–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ bot

```my_otus_alert_bot```

@BotFather –Ω–∞–ø–∏—à–µ—Ç –Ω–∞–º —Ç–æ–∫–µ–Ω, –µ–≥–æ –º—ã –≤—Å—Ç–∞–≤–ª—è–µ–º –≤ —Ñ–∞–π–ª alertmanager.yml –≤ –ø–æ–ª–µ

``` 
telegram_configs:
  - bot_token: "_—Ç–æ–∫–µ–Ω_–≤—Å—Ç–∞–≤–ª—è–µ–º_—Å—é–¥–∞_"
```

–î–∞–ª–µ–µ —Å–æ–∑–¥–∞–µ–º –∫–∞–Ω–∞–ª –≤ Telegram, –∫—É–¥–∞ –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è, –¥–æ–±–∞–≤–ª—è–µ–º –≤ —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞ –∏ –¥–∞–µ–º –µ–º—É –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

–¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –∫–∞–Ω–∞–ª –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ —Å—Å—ã–ª–∫–µ https://api.telegram.org/bot<–í–ê–®_–¢–û–ö–ï–ù>/getUpdates –∏ –∏—â–µ–º –ø–æ–ª–µ id: 

``` id: -10028736298746```

–ó–Ω–∞—á–µ–Ω–∏–µ —É —ç—Ç–æ–≥–æ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º. –≠—Ç–æ –±—É–¥–µ—Ç ID –∫–∞–Ω–∞–ª–∞, –µ–≥–æ –º—ã  –≤—Å—Ç–∞–≤–ª—è–µ–º  –≤ —Ñ–∞–π–ª alertmanager.yml –≤ –ø–æ–ª–µ

```
  chat_id: -10028736298746
```
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–∞—à–∏ –∞–ª–µ—Ä—Ç—ã –Ω–∞—á–Ω—É—Ç –ø–æ—Å—Ç—É–ø–∞—Ç—å –≤ –Ω–∞—à –∫–∞–Ω–∞–ª

–ü—Ä–∏–º–µ—Ä –≤–∏–¥–∞ –∞–ª–µ—Ä—Ç–∞

![pict1](pict/1.png)
